<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Host maps</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/index.css" rel="stylesheet">
  <style type="text/css">
  	* {
  		margin: 0px;
  		padding: 0px;
  	}
    body {
        background-color: #cccccc8f; 
    }
    nav {
        position: fixed;
        top:0px;
        overflow: hidden;
    }
  </style>
  <script type="text/javascript">
    function dialogAlert(title, content) {
        $(".Dialog").remove()
        var html = ''
        html += '<div class="Dialog"><div class="modal-backdrop fade in" style="z-index: 1040;"></div>';
        html += '<div class="modal bootstrap-dialog type-warning fade size-normal in" role="dialog" aria-hidden="true" tabindex="-1" style="z-index: 1050;display: block;text-align: center;">';
        html += '<div class="modal-dialog"><div class="modal-content">';
        html += '<div class="modal-header"><div class="bootstrap-dialog-header">';
        html +=  '<button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="closeDialog(this)">&times;</button>'
        html += '<div class="bootstrap-dialog-title" style="text-align: center;">'+title+'</div></div></div><div class="modal-body"><div class="bootstrap-dialog-body">';
        html += '<div class="bootstrap-dialog-message">';
        html += content;
        html += '</div></div></div></div></div></div></div>';
        $("body").append(html);
    }

    function userLogin() {
    var html = ''
    html += '用户名:<input style="height: 35px;margin: 10px;box-shadow: none;border: 1px solid #e5e5e5;border-radius: 2px;padding: 6px 10px;" type="text" placeholder="用户名" name="username"><br>'
    html += '密&emsp;码:<input style="height: 35px;margin: 10px;box-shadow: none;border: 1px solid #e5e5e5;border-radius: 2px;padding: 6px 10px;" type="password" box-shadow: none;border - radius: 2px;padding: 6px 10px;" placeholder="密码" name="password"><br>'
    html += '<input style="margin: 10px;" type="button" onclick="checkLogin()" class="sign-in-button btn btn-info" name="submit" value="登录"><input style="margin: 10px;" type="button" onclick="userRegister()" class="sign-in-button btn btn-info" name="regsiter" value="注册">'
    html += '<div class="rightTips"><a href="javascript:void(0);">忘记密码？</a></div></div>'
    title = '登录';
    dialogAlert(title, html);
    }

    function userRegister(){
    var html = ''
    html += '&emsp;用户名:<input style="height: 35px;margin: 10px;box-shadow: none;border: 1px solid #e5e5e5;border-radius: 2px;padding: 6px 10px;" type="text" placeholder="用户名" name="username"><br>'
    html += '&emsp;&emsp;密码:<input style="height: 35px;margin: 10px;box-shadow: none;border: 1px solid #e5e5e5;border-radius: 2px;padding: 6px 10px;" type="password" box-shadow: none;border - radius: 2px;padding: 6px 10px;" placeholder="密码" name="password"><br>'
    html += '重复密码:<input style="height: 35px;margin: 10px;box-shadow: none;border: 1px solid #e5e5e5;border-radius: 2px;padding: 6px 10px;" type="password" box-shadow: none;border - radius: 2px;padding: 6px 10px;" placeholder="重复密码" name="password"><br>'
    html += '<input style="margin: 10px;" type="button" class="sign-in-button btn btn-info" name="submit" value="注册">'
    html += '<div class="rightTips" onclick="userLogin()"><a href="javascript:void(0);">返回登录？</a></div></div>'
    title = '注册';
    dialogAlert(title, html);
    }

    function closeDialog(elem){
    $(elem).parents(".Dialog").remove();
    }

    function checkData_form() {  //检查form表单数据的合法性
        var index = true;
        var username = $("input[name='username']").val();
        var password = $("input[name='password']").val();
        $("input").css("border-color", "#ddd");
        if (username == "") {
            index = false;
            $("input[name='username']").attr("placeholder", "please enter username!");
            $("input[name='username']").attr("style", "::placeholder:red")
        }
        if (password == "") {
            index = false;
            $("input[name='password']").css("border-color", "#f33");
        }
        return index
    }
    function checkLogin() {
        var verifyInput = checkData_form();
        if (verifyInput == true) {
            var username = $("input[name='username']").val();
            var password = $("input[name='password']").val();
            data = { 'userNo': username, 'passwd': password }
            postRequest("/verifyLogin/", data, true, verifyResult);
        } else {
            alert("username or password is not should null!")
        }
    }
    function verifyResult(ret) {
        if (ret['result'] == true) {
            if (ret['user_grant'] == 0){
                window.location.href = "/userIndex/" + ret['sessionId'];
            }else{
            window.location.href = "/adminIndex/" + ret['sessionId'];
            }
        } else {
            alert(ret['error']);
        }

    }

    function addHost(elem) {
        var html = "";
        html += '<div class="item"><div class="item-nav" style="height: 36px">';
        html += '<button class="remove" onclick="removeAdd(this)">×</button></div>';
        html += '<div class="item-content"><ul class="item-li">';
        html += '<li class="li-add">hostName:<span contenteditable="true" class="hostName span-edit"></span></li>';
        html += '<li class="li-add">Ip:<span contenteditable="true" class="hostIp span-edit"></span></li>';
        html += '<li class="li-add">Port:<span contenteditable="true" class="hostPort span-edit"></span></li>';
        html += '</ul><div class="alter-info">';  
        html += '<button onclick="addHostSubmit(this)" class="btn btn-primary" name="submit">submit</button>';   
        html += '<button onclick="removeAdd(this)" class="btn btn-warning">Abort</button>';       
        html += '</div></div></div>';
        $(".content-add").before(html);
        $(".li-add").css("border-bottom","none"); 
        $(".hostName[contenteditable='true']").focus();
    }
    function addHostSubmit(elem){
        var item = $(elem).parents(".item-content");
        var hostName = item.find(".hostName").text();
        var hostIp = item.find(".hostIp").text();
        var hostPort = item.find(".hostPort").text();
        data = {'hostName': hostName, 'hostIp': hostIp, 'hostPort': hostPort};
        //alert(hostName)
        //alert(hostIp)
        //alert(hostPort)
        postRequest("/addHost/",data,true,addHostResult);
    }

    function addHostResult(ret) {
        if(ret['ret'] == true){
            alert("add host success!");
            location.reload()
        }else{
            alert("add host error!");
            location.reload()
        }
    }

    function alterHost(elem) {
        var item = $(elem).parents(".item").children().eq(1).children(".item-li").find("li");
        var itemBtn = $(elem).parents(".item").children().eq(1).children(".alter-info");
        item.children("span").addClass("span-edit");
        item.children("span").attr("contenteditable","true");
        item.css("border-bottom","none");
        item.filter(".enter-li").css("display","none");
        itemBtn.css("display","flex");
    }

    function alterSubmit(elem){
        var item = $(elem).parents(".item-host");
        var hostId = item.parents(".item").attr("data-tid");
        var hostName = item.find(".hostName").text();
        var hostIp = item.find(".hostIp").text();
        var hostPort = item.find(".hostPort").text();
        data = {'hostId':hostId, 'hostName': hostName, 'hostIp': hostIp, 'hostPort': hostPort};
        //alert(hostId)
        //alert(hostIp)
        //alert(hostPort)
        postRequest("/updateHost/",data,true,alterHostResult);
    }

    function alterHostResult(ret){
        if(ret['ret'] == true){
            alert("alter Host is success!");
            location.reload()
        }else{
            alert("alter Host is error!");
            location.reload()
        }
    }
    function delHost(elem) {
        //comfirm to delete host?
       var reply = confirm("are you sure to delete?")
       if(reply == true){
            var hostId = $(elem).parents(".item").attr("data-tid");
            //alert(hostId);
            data = {'hostId': hostId}
            postRequest("/delHost/",data,true,delHostResult);
        }else{
            alert("you are abotered it!")
        }
    }
    function delHostResult(ret){
        if(ret['ret'] == true){
            alert("delete host success!");
            location.reload()
        }else {
            alert("delete host error!");
        }
    }
    function alterReset(elem) {
        var items = $(elem).parent().parent().find(".item-li span");
        items.text("");
    }
    function alterAbort(elem) {
        location.reload()
    }
    function removeAdd(elem) {
        $(elem).parents(".item").remove();
    }

function filterHost() {
    var keyWords = $("input[name='sinput']").val();
    //alert(keyWords)
    getRequest("/filterHost/", "keyWords="+keyWords, true, filterHostResult);
}
function enterSearch(){
    $("input[name = 'sinput']").keydown(function(event){  
        if(event.which == "13")      
            filterHost(); 
    })
}
function filterHostResult(ret) {
    if(ret) {
        var newDoc = document.open("text/html", "replace");
        newDoc.write(ret);
        newDoc.close();
    }
}
   /* function btnClick(){
        $("btn-fade").click(function(){
            $("this").css("background-color","#00f");
        });
    }*/
  </script>
  </head>
  <body>
    <nav>你好，世界！
        <button type="text" onclick="userLogin()" class="btn btn-link logout " style="float: right;font-size: 20px;color:black;">登录/注册？</button>
    </nav>
    <div class="search">
    <input type="text" onfocus="enterSearch()" placeholder="搜索..." name="sinput" class="sinput">
    <input type="button" onclick="filterHost()" class="sbt" name="search" value="搜索">
	</div>
    <div class="container">    	
    {% include 'host.html' %}
    <div  class="content-add">
    <button onclick="addHost(this)" class="new-host btn-fade">+</button> 
    </div>
    <div class="bottom-add">
        <button onclick="addHost(this)" class="new-host btn-fade" style="margin: auto 50px;">+</button>
    </div>
    <script src="/static/js/jquery-1.12.4.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/ajax.js"></script>
    <script src="/static/js/text-utils.js"></script>
    <script>
    $(function () {
            $("input[name = 'username']").keydown(function (event) {
                if (event.which == "13")
                    $("input[name = 'password']").focus()
            })
            $("input[name = 'password']").keydown(function (event) {
                if (event.which == "13")
                    checkLogin();
            })
            $("input[name = 'submit']").click(function () {
                checkLogin();
            });
        })
    </script>
  </body>
</html>